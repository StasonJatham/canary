<!doctype html><html lang=en data-bs-theme=light><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Canary CT Monitor - Rule Management"><title>Rules - Canary CT Monitor</title><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css><link rel=stylesheet href=/theme.css><link rel=icon type=image/jpeg href=/canary.jpg><nav class="navbar navbar-expand-lg sticky-top border-bottom"><div class=container-fluid><a class="navbar-brand d-flex align-items-center" href=/dashboard.html><img src=/canary.jpg alt=Canary width=32 height=32 class=me-2>
<span class=fw-bold>Canary CT Monitor</span>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/dashboard.html><i class="bi bi-speedometer2 me-1"></i>Dashboard</a><li class=nav-item><a class="nav-link active" href=/rules.html><i class="bi bi-list-check me-1"></i>Rules</a></ul><div class="d-flex align-items-center gap-3"><span class="badge bg-success" id=statusBadge><i class="bi bi-check-circle me-1"></i>Online
</span><button class="btn btn-sm btn-outline-secondary" id=themeToggle title="Toggle theme">
<i class="bi bi-moon-fill"></i>
</button>
<button class="btn btn-sm btn-outline-danger" id=logoutBtn title=Logout>
<i class="bi bi-box-arrow-right"></i></button></div></div></div></nav><main class="container-fluid py-4"><div class="d-flex justify-content-between align-items-center mb-4"><div><h2 class=mb-1>Detection Rules</h2><p class="text-muted mb-0">Manage boolean expression rules for certificate monitoring</div><button class="btn btn-primary" id=addRuleBtn style=display:none>
<i class="bi bi-plus-lg me-1"></i>Add Rule</button></div><div class="card border"><div class="card-header d-flex justify-content-between align-items-center"><div><h5 class=mb-0>Active Rules</h5><small class=text-muted><span id=rulesCount>0</span> rules loaded</small></div><button class="btn btn-sm btn-outline-secondary" id=reloadRulesBtn style=display:none>
<i class="bi bi-arrow-clockwise me-1"></i>Reload from YAML</button></div><div class="card-body p-0"><div class=table-responsive><table class="table table-hover mb-0"><thead class=table-light><tr><th style=width:50px>Status<th>Name<th>Expression<th style=width:100px>Priority<th style=width:120px>Order<th style=width:150px>Actions<tbody id=rulesTableBody><tr><td colspan=6 class="text-center text-muted py-5"><div class="spinner-border text-primary mb-2" role=status><span class=visually-hidden>Loading...</span></div><div>Loading rules...</div></table></div></div></div><div class="card border mt-4"><div class=card-header><h5 class=mb-0>Rule Syntax Guide</h5></div><div class=card-body><div class=row><div class=col-md-6><h6>Boolean Operators</h6><table class="table table-sm"><tbody><tr><td><code>AND</code><td>Both conditions must be true<tr><td><code>OR</code><td>At least one condition must be true<tr><td><code>NOT</code><td>Excludes matches (negation)<tr><td><code>( )</code><td>Grouping for precedence</table></div><div class=col-md-6><h6>Examples</h6><ul class=list-unstyled><li class=mb-2><code class=text-primary>login AND paypal</code><br><small class=text-muted>Matches domains with both keywords</small><li class=mb-2><code class=text-primary>(twitter OR x.com) AND login</code><br><small class=text-muted>Matches twitter/x with login</small><li class=mb-2><code class=text-primary>bank AND NOT official</code><br><small class=text-muted>Bank domains excluding official ones</small><li class=mb-2><code class=text-primary>(paypal OR stripe) AND login AND NOT (paypal.com OR stripe.com)</code><br><small class=text-muted>Payment phishing excluding official domains</small></ul></div></div><div class="alert alert-info mb-0 mt-3"><i class="bi bi-info-circle me-2"></i>
<strong>Note:</strong> NOT keywords are checked separately to ensure proper exclusion. Order of operators doesn't matter - expressions are parsed into a tree structure.</div></div></div></main><div class="modal fade" id=ruleModal tabindex=-1><div class="modal-dialog modal-lg"><div class=modal-content><div class=modal-header><h5 class=modal-title id=ruleModalTitle>Add Rule</h5><button type=button class=btn-close data-bs-dismiss=modal></button></div><form id=ruleForm><div class=modal-body><div class=mb-3><label for=ruleName class=form-label>Rule Name <span class=text-danger>*</span></label>
<input class=form-control id=ruleName required placeholder="e.g., paypal_phish">
<small class=text-muted>Unique identifier for this rule (lowercase, no spaces)</small></div><div class=mb-3><label for=ruleExpression class=form-label>Boolean Expression <span class=text-danger>*</span></label>
<textarea class="form-control font-monospace" id=ruleExpression rows=3 required placeholder="e.g., (paypal OR stripe) AND login AND NOT (paypal.com OR stripe.com)"></textarea>
<small class=text-muted>Use AND, OR, NOT operators with parentheses for grouping</small></div><div class=row><div class=col-md-6><div class=mb-3><label for=rulePriority class=form-label>Priority <span class=text-danger>*</span></label>
<select class=form-select id=rulePriority required><option value=critical>Critical<option value=high selected>High<option value=medium>Medium<option value=low>Low</select></div></div><div class=col-md-6><div class=mb-3><label for=ruleEnabled class=form-label>Status</label>
<select class=form-select id=ruleEnabled><option value=true selected>Enabled<option value=false>Disabled</select></div></div></div><div class=mb-3><label for=ruleComment class=form-label>Description</label>
<textarea class=form-control id=ruleComment rows=2 placeholder="Brief description of what this rule detects"></textarea></div><div class="alert alert-warning mb-0"><i class="bi bi-exclamation-triangle me-2"></i>
<strong>Validation:</strong> The expression will be validated before saving. Ensure all keywords are lowercase.</div></div><div class=modal-footer><button type=button class="btn btn-secondary" data-bs-dismiss=modal>Cancel</button>
<button class="btn btn-primary" id=saveRuleBtn>
<i class="bi bi-check-lg me-1"></i>Save Rule</button></div></form></div></div></div><div class="modal fade" id=deleteModal tabindex=-1><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Confirm Delete</h5><button type=button class=btn-close data-bs-dismiss=modal></button></div><div class=modal-body><p class=mb-0>Are you sure you want to delete the rule <strong id=deleteRuleName></strong>?<p class="text-muted small mb-0 mt-2">This action cannot be undone.</div><div class=modal-footer><button type=button class="btn btn-secondary" data-bs-dismiss=modal>Cancel</button>
<button type=button class="btn btn-danger" id=confirmDeleteBtn>
<i class="bi bi-trash me-1"></i>Delete</button></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js></script><script src=/js/rules.js></script>